{% extends 'base.html' %}

{% block title %}My Disputes{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold text-gray-800 mb-6">My Disputes</h1>

{% for dispute in disputes %}
<div class="bg-white rounded-xl shadow card-hover mb-6 fade-in-up">
  <!-- Header -->
  <div class="flex justify-between items-center border-b border-gray-200 p-4">
    <div>
      <h6 class="font-semibold text-gray-800">Dispute #{{ dispute.id }}</h6>
      <p class="text-sm text-gray-500">{{ dispute.submission.task.title }}</p>
    </div>
    <span class="px-3 py-1 rounded-full text-xs font-semibold
      {% if dispute.status == 'open' %} bg-yellow-100 text-yellow-800
      {% elif dispute.status == 'investigating' %} bg-blue-100 text-blue-800
      {% elif dispute.status == 'resolved_favor_member' %} bg-green-100 text-green-800
      {% elif dispute.status == 'resolved_favor_advertiser' %} bg-red-100 text-red-800
      {% else %} bg-gray-100 text-gray-800 {% endif %}">
      {{ dispute.get_status_display }}
    </span>
  </div>

  <!-- Body -->
  <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Left: Reason & Admin Notes -->
    <div class="md:col-span-2 space-y-4">
      <div>
        <p class="font-medium text-gray-700">Dispute Reason:</p>
        <p class="text-gray-600">{{ dispute.reason }}</p>
      </div>

      {% if dispute.admin_notes %}
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <p class="font-medium text-blue-800">Admin Notes:</p>
        <p class="text-blue-700">{{ dispute.admin_notes }}</p>
      </div>
      {% endif %}
    </div>

    <!-- Right: Meta Info -->
    <div class="space-y-2 text-sm">
      <p><strong>Created:</strong> {{ dispute.created_at|date:"M d, Y H:i" }}</p>
      {% if dispute.resolved_at %}
      <p><strong>Resolved:</strong> {{ dispute.resolved_at|date:"M d, Y H:i" }}</p>
      <p><strong>Resolved by:</strong> {{ dispute.resolved_by.username }}</p>
      {% endif %}
      <a href="{% url 'tasks:dispute_detail' dispute.id %}" class="btn-primary btn-sm mt-2">
        View Details
      </a>
    </div>
  </div>
</div>
{% empty %}
<div class="text-center py-12 fade-in-up">
  <i class="fas fa-balance-scale fa-3x text-gray-400 mb-3"></i>
  <h4 class="text-lg font-semibold text-gray-700">No disputes filed</h4>
  <p class="text-gray-500">You haven't filed any disputes yet.</p>
  <a href="{% url 'tasks:my_submissions' %}" class="btn-primary mt-4">View My Submissions</a>
</div>
{% endfor %}
{% endblock %}
